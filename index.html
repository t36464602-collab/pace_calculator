<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pacer Pro - 專業跑步配速計算器</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React & Babel CDNs -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&family=Noto+Sans+TC:wght@400;700;900&family=JetBrains+Mono:wght@700&display=swap');
        
        body {
            font-family: 'Inter', 'Noto Sans TC', sans-serif;
        }

        .font-mono-run {
            font-family: 'JetBrains Mono', monospace;
        }

        /* 隱藏輸入框的上下箭頭 */
        input::-webkit-outer-spin-button,
        input::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        input[type=number] {
            -moz-appearance: textfield;
        }

        .grid-rows-road {
            grid-template-rows: repeat(6, minmax(0, 1fr));
        }

        .grid-rows-track {
            grid-template-rows: repeat(4, minmax(0, 1fr));
        }
    </style>
</head>
<body class="bg-slate-50">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo, useCallback } = React;

        // 簡易 Lucide 圖標組件
        const Icon = ({ name, size = 20, className = "" }) => {
            useEffect(() => {
                if (window.lucide && typeof window.lucide.createIcons === 'function') {
                    window.lucide.createIcons();
                }
            }, [name, className]);
            
            // Tailwind 寬高轉換
            const sizeClass = `w-${Math.ceil(size/4)} h-${Math.ceil(size/4)}`;
            return <i data-lucide={name} className={`${sizeClass} ${className} inline-block`}></i>;
        };

        const App = () => {
            // 輸入狀態
            const [tableType, setTableType] = useState('road'); // 'road' | 'track'
            const [distance, setDistance] = useState(''); 
            const [hours, setHours] = useState('');
            const [minutes, setMinutes] = useState('');
            const [seconds, setSeconds] = useState('');
            const [paceMin, setPaceMin] = useState('');
            const [paceSec, setPaceSec] = useState('');
            
            // 顯示結果狀態
            const [displayResults, setDisplayResults] = useState(null);
            
            // 計算目標：'pace' | 'distance' | 'time'
            const [calcTarget, setCalcTarget] = useState('pace');

            // 常數定義
            const ROAD_MILESTONES = [1, 5, 10, 15, 20, 21.0975, 25, 30, 35, 40, 42.195];
            const TRACK_MILESTONES = [0.1, 0.2, 0.3, 0.4, 0.8, 1.0, 1.6, 2.0];

            // 輔助函式：時間格式化
            const formatSecondsToTime = (totalSec, type) => {
                if (!isFinite(totalSec) || totalSec < 0) return { h: 0, m: 0, s: 0, clock: "0:00" };
                const h = Math.floor(totalSec / 3600);
                const m = Math.floor((totalSec % 3600) / 60);
                const s = Math.round(totalSec % 60);
                
                if (type === 'track') {
                    const totalMin = Math.floor(totalSec / 60);
                    return { h: 0, m: totalMin, s, clock: `${totalMin}:${s.toString().padStart(2, '0')}` };
                }
                return {
                    h, m, s,
                    clock: h > 0 ? `${h}:${m.toString().padStart(2, '0')}:${s.toString().padStart(2, '0')}` : `${m}:${s.toString().padStart(2, '0')}`
                };
            };

            const formatPaceParts = (totalSec) => {
                if (!isFinite(totalSec) || totalSec <= 0) return { m: 0, s: 0, str: "0'00\"" };
                const m = Math.floor(totalSec / 60);
                const s = Math.round(totalSec % 60);
                return { m, s, str: `${m}'${s.toString().padStart(2, '0')}"` };
            };

            // 手動執行計算
            const handleStartCalc = useCallback(() => {
                let d = parseFloat(distance) || 0;
                let t = (parseInt(hours) || 0) * 3600 + (parseInt(minutes) || 0) * 60 + (parseInt(seconds) || 0);
                let p = (parseInt(paceMin) || 0) * 60 + (parseInt(paceSec) || 0);

                let calcPace = p;
                let calcTime = t;
                let calcDist = d;

                // 執行對應計算並回填
                if (calcTarget === 'pace') {
                    if (d > 0 && t > 0) {
                        calcPace = t / d;
                        const parts = formatPaceParts(calcPace);
                        setPaceMin(parts.m.toString());
                        setPaceSec(parts.s.toString());
                    }
                } else if (calcTarget === 'time') {
                    if (d > 0 && p > 0) {
                        calcTime = d * p;
                        const parts = formatSecondsToTime(calcTime, tableType);
                        setHours(parts.h > 0 ? parts.h.toString() : '');
                        setMinutes(parts.m.toString());
                        setSeconds(parts.s.toString());
                    }
                } else if (calcTarget === 'distance') {
                    if (t > 0 && p > 0) {
                        calcDist = t / p;
                        setDistance(tableType === 'track' ? calcDist.toFixed(3) : calcDist.toFixed(2));
                    }
                }

                const milestones = tableType === 'road' ? ROAD_MILESTONES : TRACK_MILESTONES;
                const splitData = milestones.map(m => {
                    const timeAtM = m * calcPace;
                    const f = formatSecondsToTime(timeAtM, tableType);
                    let label = `${m}k`;
                    if (tableType === 'road') {
                        if (m === 21.0975) label = "半馬 (21.0975k)";
                        if (m === 42.195) label = "全馬 (42.195k)";
                    } else {
                        label = `${Math.round(m * 1000)}m`;
                    }
                    return { label, clock: f.clock, km: m };
                });

                setDisplayResults({
                    pace: formatPaceParts(calcPace).str,
                    time: formatSecondsToTime(calcTime, tableType).clock,
                    dist: tableType === 'track' ? Math.round(calcDist * 1000) : calcDist.toFixed(2),
                    kmh: calcPace > 0 ? (3600 / calcPace).toFixed(1) : "0.0",
                    splits: splitData,
                    mode: calcTarget,
                    currentKm: calcDist,
                    unit: tableType === 'road' ? 'km' : 'm',
                    timeLabel: tableType === 'road' ? '總計時間' : '單組時間'
                });
            }, [distance, hours, minutes, seconds, paceMin, paceSec, calcTarget, tableType]);

            const reset = () => {
                setDistance(''); setHours(''); setMinutes(''); setSeconds(''); setPaceMin(''); setPaceSec('');
                setDisplayResults(null);
            };

            return (
                <div className="min-h-screen p-4 md:p-8">
                    <div className="max-w-6xl mx-auto space-y-8">
                        
                        {/* Header */}
                        <header className="flex flex-col md:flex-row md:items-end justify-between gap-4">
                            <div>
                                <div className="flex items-center gap-3 mb-2">
                                    <div className="bg-orange-500 p-2 rounded-xl shadow-lg shadow-orange-200">
                                        <Icon name="activity" size={32} className="text-white" />
                                    </div>
                                    <h1 className="text-3xl font-black tracking-tight uppercase">Pacer <span className="text-orange-500">Pro</span></h1>
                                </div>
                                <p className="text-slate-500 font-medium">專業跑步配速計算工具</p>
                            </div>

                            <div className="bg-white p-1 rounded-xl shadow-sm border border-slate-200 flex">
                                <button 
                                    onClick={() => {setTableType('road'); reset();}}
                                    className={`px-6 py-2 rounded-lg text-sm font-bold transition-all ${tableType === 'road' ? 'bg-slate-900 text-white shadow-md' : 'text-slate-500 hover:bg-slate-50'}`}
                                >
                                    路跑模式 (km)
                                </button>
                                <button 
                                    onClick={() => {setTableType('track'); reset();}}
                                    className={`px-6 py-2 rounded-lg text-sm font-bold transition-all ${tableType === 'track' ? 'bg-slate-900 text-white shadow-md' : 'text-slate-500 hover:bg-slate-50'}`}
                                >
                                    田徑場模式 (m)
                                </button>
                            </div>
                        </header>

                        <div className="grid grid-cols-1 lg:grid-cols-12 gap-8">
                            
                            {/* Left Column: Inputs */}
                            <div className="lg:col-span-4 space-y-6">
                                <div className="bg-white p-6 rounded-3xl shadow-sm border border-slate-200 space-y-8">
                                    <div className="flex items-center justify-between border-b pb-4">
                                        <h2 className="font-bold flex items-center gap-2">
                                            <Icon name="sliders" size={20} className="text-orange-500" /> 參數輸入
                                        </h2>
                                        <button 
                                            onClick={reset} 
                                            className="text-base font-black text-red-600 border-2 border-red-500 hover:bg-red-50 px-5 py-2 rounded-xl transition-all flex items-center gap-1 shadow-sm active:scale-95"
                                        >
                                            <Icon name="trash-2" size={16} /> 重置
                                        </button>
                                    </div>

                                    {/* Distance Input */}
                                    <div className="space-y-3">
                                        <div className="flex justify-between items-center">
                                            <div className="flex items-center gap-2">
                                                <button 
                                                    onClick={() => setCalcTarget('distance')}
                                                    className={`flex items-center gap-1 px-2 py-0.5 rounded-full text-[10px] font-black uppercase transition-all ${calcTarget === 'distance' ? 'bg-orange-500 text-white' : 'bg-slate-100 text-slate-400'}`}
                                                >
                                                    <Icon name="target" size={12} className={calcTarget === 'distance' ? 'text-white' : 'text-slate-400'} /> 計算
                                                </button>
                                                <label className={`text-xs font-black uppercase tracking-widest ${calcTarget === 'distance' ? 'text-orange-500' : 'text-slate-400'}`}>目標距離</label>
                                            </div>
                                            <div className="flex flex-wrap gap-1 justify-end">
                                                {(tableType === 'road' ? [1, 5, 10, 21.0975, 42.195] : [200, 400, 800, 1600]).map(btn => (
                                                    <button 
                                                        key={btn}
                                                        disabled={calcTarget === 'distance'}
                                                        onClick={() => setDistance(tableType === 'track' ? (btn/1000).toString() : btn.toString())}
                                                        className={`text-[10px] px-2 py-1 rounded font-bold transition-colors ${calcTarget === 'distance' ? 'bg-slate-50 text-slate-300' : 'bg-slate-100 hover:bg-orange-100 text-slate-600'}`}
                                                    >
                                                        {btn === 21.0975 ? '半馬' : btn === 42.195 ? '全馬' : btn}{tableType === 'road' && btn !== 21.0975 && btn !== 42.195 ? 'k' : (tableType === 'track' ? 'm' : '')}
                                                    </button>
                                                ))}
                                            </div>
                                        </div>
                                        <div className={`flex items-center bg-slate-50 border-2 rounded-2xl p-4 transition-all ${calcTarget === 'distance' ? 'border-orange-500 bg-orange-50 shadow-[0_0_10px_rgba(249,115,22,0.1)]' : 'border-transparent focus-within:border-slate-300'}`}>
                                            <input 
                                                type="number" 
                                                readOnly={calcTarget === 'distance'}
                                                value={tableType === 'track' ? (distance ? (parseFloat(distance)*1000).toFixed(0) : '') : distance}
                                                onChange={(e) => {
                                                    const val = e.target.value;
                                                    setDistance(tableType === 'track' ? (val ? (parseFloat(val)/1000).toString() : '') : val);
                                                }}
                                                placeholder={calcTarget === 'distance' ? '等待計算...' : '請輸入'}
                                                className={`bg-transparent w-full text-2xl font-black outline-none ${calcTarget === 'distance' ? 'text-orange-600' : 'text-slate-800 placeholder:text-slate-200'}`}
                                            />
                                            <span className={`font-bold ${calcTarget === 'distance' ? 'text-orange-400' : 'text-slate-400'}`}>{tableType === 'road' ? 'km' : 'm'}</span>
                                        </div>
                                    </div>

                                    {/* Time Input */}
                                    <div className="space-y-3">
                                        <div className="flex items-center gap-2">
                                            <button 
                                                onClick={() => setCalcTarget('time')}
                                                className={`flex items-center gap-1 px-2 py-0.5 rounded-full text-[10px] font-black uppercase transition-all ${calcTarget === 'time' ? 'bg-orange-500 text-white' : 'bg-slate-100 text-slate-400'}`}
                                            >
                                                <Icon name="target" size={12} className={calcTarget === 'time' ? 'text-white' : 'text-slate-400'} /> 計算
                                            </button>
                                            <label className={`text-xs font-black uppercase tracking-widest ${calcTarget === 'time' ? 'text-orange-500' : 'text-slate-400'}`}>
                                                {tableType === 'road' ? '總時間' : '單組時間'}
                                            </label>
                                        </div>
                                        <div className={`flex items-center justify-between p-3 rounded-2xl border-2 transition-all ${calcTarget === 'time' ? 'border-orange-500 bg-orange-50 shadow-[0_0_10px_rgba(249,115,22,0.1)]' : 'border-slate-50 bg-slate-50'}`}>
                                            {tableType === 'road' && (
                                                <>
                                                    <div className="flex-1 relative h-10 flex items-center">
                                                        <input type="number" readOnly={calcTarget === 'time'} value={hours} onChange={e => setHours(e.target.value)} className={`w-full bg-transparent text-xl font-black text-center outline-none ${calcTarget === 'time' ? 'text-orange-600' : 'text-slate-800'}`} placeholder="0" />
                                                        <span className={`absolute bottom-0 right-1 text-[9px] font-bold leading-none pointer-events-none ${calcTarget === 'time' ? 'text-orange-400' : 'text-slate-400'}`}>時</span>
                                                    </div>
                                                    <div className="flex items-center px-1"><span className="text-xl font-black text-slate-300">:</span></div>
                                                </>
                                            )}
                                            <div className="flex-1 relative h-10 flex items-center">
                                                <input type="number" readOnly={calcTarget === 'time'} value={minutes} onChange={e => setMinutes(e.target.value)} className={`w-full bg-transparent text-xl font-black text-center outline-none ${calcTarget === 'time' ? 'text-orange-600' : 'text-slate-800'}`} placeholder="0" />
                                                <span className={`absolute bottom-0 right-1 text-[9px] font-bold leading-none pointer-events-none ${calcTarget === 'time' ? 'text-orange-400' : 'text-slate-400'}`}>分</span>
                                            </div>
                                            <div className="flex items-center px-1"><span className="text-xl font-black text-slate-300">:</span></div>
                                            <div className="flex-1 relative h-10 flex items-center">
                                                <input type="number" readOnly={calcTarget === 'time'} value={seconds} onChange={e => setSeconds(e.target.value)} className={`w-full bg-transparent text-xl font-black text-center outline-none ${calcTarget === 'time' ? 'text-orange-600' : 'text-slate-800'}`} placeholder="0" />
                                                <span className={`absolute bottom-0 right-1 text-[9px] font-bold leading-none pointer-events-none ${calcTarget === 'time' ? 'text-orange-400' : 'text-slate-400'}`}>秒</span>
                                            </div>
                                        </div>
                                    </div>

                                    {/* Pace Input */}
                                    <div className="space-y-3">
                                        <div className="flex items-center gap-2">
                                            <button 
                                                onClick={() => setCalcTarget('pace')}
                                                className={`flex items-center gap-1 px-2 py-0.5 rounded-full text-[10px] font-black uppercase transition-all ${calcTarget === 'pace' ? 'bg-orange-500 text-white' : 'bg-slate-100 text-slate-400'}`}
                                            >
                                                <Icon name="target" size={12} className={calcTarget === 'pace' ? 'text-white' : 'text-slate-400'} /> 計算
                                            </button>
                                            <label className={`text-xs font-black uppercase tracking-widest ${calcTarget === 'pace' ? 'text-orange-500' : 'text-slate-400'}`}>平均配速</label>
                                        </div>
                                        <div className={`flex items-center justify-between p-3 rounded-2xl border-2 transition-all ${calcTarget === 'pace' ? 'border-orange-500 bg-orange-50 shadow-[0_0_10px_rgba(249,115,22,0.1)]' : 'border-slate-50 bg-slate-50'}`}>
                                            <div className="flex-1 relative h-10 flex items-center">
                                                <input type="number" readOnly={calcTarget === 'pace'} value={paceMin} onChange={e => setPaceMin(e.target.value)} className={`w-full bg-transparent text-xl font-black text-center outline-none ${calcTarget === 'pace' ? 'text-orange-600' : 'text-slate-800'}`} placeholder="0" />
                                                <span className={`absolute bottom-0 right-1 text-[9px] font-bold leading-none pointer-events-none ${calcTarget === 'pace' ? 'text-orange-400' : 'text-slate-400'}`}>分</span>
                                            </div>
                                            <div className="flex items-center px-1"><span className="text-xl font-black text-slate-300">:</span></div>
                                            <div className="flex-1 relative h-10 flex items-center">
                                                <input type="number" readOnly={calcTarget === 'pace'} value={paceSec} onChange={e => setPaceSec(e.target.value)} className={`w-full bg-transparent text-xl font-black text-center outline-none ${calcTarget === 'pace' ? 'text-orange-600' : 'text-slate-800'}`} placeholder="0" />
                                                <span className={`absolute bottom-0 right-1 text-[9px] font-bold leading-none pointer-events-none ${calcTarget === 'pace' ? 'text-orange-400' : 'text-slate-400'}`}>秒</span>
                                            </div>
                                            <div className={`flex items-center px-2 font-bold whitespace-nowrap pt-3 ${calcTarget === 'pace' ? 'text-orange-400' : 'text-slate-400'}`}>/ km</div>
                                        </div>
                                    </div>

                                    {/* Action Button */}
                                    <button 
                                        onClick={handleStartCalc}
                                        className="w-full bg-orange-500 hover:bg-orange-600 text-white font-black py-5 rounded-2xl shadow-xl shadow-orange-200 transition-all active:scale-[0.98] flex items-center justify-center gap-3 text-xl ring-4 ring-orange-500/10"
                                    >
                                        <Icon name="play" size={24} className="fill-current" /> 開始計算結果
                                    </button>
                                </div>
                            </div>

                            {/* Right Column: Display Results */}
                            <div className="lg:col-span-8 flex flex-col gap-6">
                                
                                {/* Result Display Cards */}
                                {displayResults ? (
                                    <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                                        <div className={`p-6 rounded-3xl border-2 transition-all shadow-xl relative overflow-hidden group ${displayResults.mode === 'distance' ? 'bg-gradient-to-br from-orange-500 to-orange-600 border-orange-400 text-white' : 'bg-white border-slate-200 text-slate-900 shadow-sm'}`}>
                                            <div className={`text-[10px] font-black uppercase mb-1 tracking-tighter ${displayResults.mode === 'distance' ? 'text-orange-100' : 'text-slate-400'}`}>目標距離</div>
                                            <div className="text-4xl font-black tracking-tight">{displayResults.dist} <span className={`text-sm font-bold ${displayResults.mode === 'distance' ? 'text-orange-200' : 'text-slate-400'}`}>{displayResults.unit}</span></div>
                                            {displayResults.mode === 'distance' && <div className="absolute top-0 right-0 px-3 py-1 bg-white text-orange-600 text-[8px] font-black rounded-bl-xl shadow-sm">推算結果</div>}
                                        </div>
                                        
                                        <div className={`p-6 rounded-3xl border-2 transition-all shadow-xl relative overflow-hidden group ${displayResults.mode === 'time' ? 'bg-gradient-to-br from-orange-500 to-orange-600 border-orange-400 text-white' : 'bg-white border-slate-200 text-slate-900 shadow-sm'}`}>
                                            <div className={`text-[10px] font-black uppercase mb-1 tracking-tighter ${displayResults.mode === 'time' ? 'text-orange-100' : 'text-slate-400'}`}>{displayResults.timeLabel}</div>
                                            <div className="text-4xl font-black tracking-tight">{displayResults.time}</div>
                                            {displayResults.mode === 'time' && <div className="absolute top-0 right-0 px-3 py-1 bg-white text-orange-600 text-[8px] font-black rounded-bl-xl shadow-sm">推算結果</div>}
                                        </div>

                                        <div className={`p-6 rounded-3xl border-2 transition-all shadow-xl relative overflow-hidden group ${displayResults.mode === 'pace' ? 'bg-gradient-to-br from-orange-500 to-orange-600 border-orange-400 text-white' : 'bg-white border-slate-200 text-slate-900 shadow-sm'}`}>
                                            <div className="flex justify-between items-start">
                                                <div className={`text-[10px] font-black uppercase mb-1 tracking-tighter ${displayResults.mode === 'pace' ? 'text-orange-100' : 'text-slate-400'}`}>平均配速</div>
                                                <div className={`${displayResults.mode === 'pace' ? 'bg-white/20' : 'bg-orange-500'} backdrop-blur-md text-white text-[9px] px-2 py-0.5 rounded-full font-black border border-white/20`}>{displayResults.kmh} km/h</div>
                                            </div>
                                            <div className="text-4xl font-black tracking-tight">{displayResults.pace} <span className={`text-sm font-bold ${displayResults.mode === 'pace' ? 'text-orange-200' : 'text-slate-400'}`}>/km</span></div>
                                            {displayResults.mode === 'pace' && <div className="absolute top-0 right-0 px-3 py-1 bg-white text-orange-600 text-[8px] font-black rounded-bl-xl shadow-sm">推算結果</div>}
                                        </div>
                                    </div>
                                ) : (
                                    <div className="bg-white p-12 rounded-3xl border-2 border-dashed border-slate-200 flex flex-col items-center justify-center text-slate-400 shadow-inner text-center">
                                        <Icon name="play" size={48} className="mb-4 opacity-20" />
                                        <p className="font-bold uppercase tracking-widest text-xs">請輸入數值後點擊<br/>「開始計算」</p>
                                    </div>
                                )}

                                {/* Split Table */}
                                <div className="flex-grow bg-white rounded-3xl shadow-sm border border-slate-200 overflow-hidden flex flex-col">
                                    <div className="flex items-center gap-2 px-6 py-5 border-b bg-slate-50/50">
                                        <Icon name="list-ordered" size={20} className="text-orange-500" />
                                        <h4 className="font-bold text-slate-700 text-lg">里程分段對照表</h4>
                                    </div>

                                    <div className="p-8 overflow-x-auto">
                                        {displayResults ? (
                                            <div className={`grid grid-flow-col grid-cols-2 ${tableType === 'road' ? 'grid-rows-road' : 'grid-rows-track'} gap-x-12 gap-y-4 min-w-[300px]`}>
                                                {displayResults.splits.map((split, i) => {
                                                    const isMatch = Math.abs(split.km - displayResults.currentKm) < 0.0001;
                                                    return (
                                                        <div 
                                                            key={i} 
                                                            className={`flex items-center justify-between p-4 rounded-2xl border transition-all group ${isMatch ? 'bg-orange-500 border-orange-400 text-white shadow-lg shadow-orange-100' : 'border-slate-100 bg-slate-50/50 hover:bg-orange-50 hover:border-orange-100'}`}
                                                        >
                                                            <span className={`text-[11px] font-black uppercase truncate mr-2 ${isMatch ? 'text-orange-100' : 'text-slate-400 group-hover:text-orange-500'}`}>{split.label}</span>
                                                            <span className={`text-xl font-mono-run font-bold ${isMatch ? 'text-white' : 'text-slate-800 group-hover:text-orange-600'}`}>{split.clock}</span>
                                                        </div>
                                                    );
                                                })}
                                            </div>
                                        ) : (
                                            <div className="py-20 text-center text-slate-300 italic font-medium">按下計算後將產生詳細分段對照表</div>
                                        )}
                                    </div>

                                    <div className="p-4 bg-slate-50 border-t mt-auto flex items-center justify-end">
                                        <div className="text-[10px] text-slate-300 font-black tracking-widest uppercase tracking-widest">Pacer Pro Engine</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
